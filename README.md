Cristina Drinciu 324CA

# DATAPLANE ROUTER

This project implements a router's dataplane that can handle the packets using protocols such as IPv4, ARP and ICMP.
The assignments implements all the given quests, earning 100 points.

## Initialization
The router is initialized at the beginning of the program with its specific components:
* ### Routing Table:
    It is given as an array and the converted to a trie data structure so that the search for route is more efficient.
* ### ARP Table/Cache
    An array that stores the pairs (IP, MAC).
* ### Waiting Packets Queue
    Classic queue that stores the waitng paktes after an ARP request (the buffer, the length and the route).

## IPv4

    void ip_packet_processing(struct ether_header *eth_hdr, int interface, size_t len, char buf[], route_trie_t *routing_trie, struct arp_table_entry *arp_table, int arp_table_len, queue waiting_packets)

This function processes incoming IPv4 packets. It performs the following tasks:

   * Checks if the packet is for the router itself or for broadcast. If so, it generates an ICMP message (Echo Reply).
   * Verifies the integrity of the IP header using checksum.
   * Decrements the TTL and checks if it's zero, generating an ICMP Time Exceeded message if so.
   * Finds the best route for the destination IP address using LPM algorithm, optimised with trie search.
   * If the destination is unreachable, it generates an ICMP Destination Unreachable message.
   * Updates the IP checksum and Ethernet header.
   * Sends the packet.

## ARP

    void arp_packet_processing(char *buf, size_t len, int interface, struct arp_table_entry *arp_table, int *arp_table_len, queue waiting_packets)

This function processes incoming ARP packets. It performs the following tasks:

   * Determines if the ARP packet is a request or a reply.
   * If it's a request and the target IP matches the interface IP, it generates an ARP reply.
   * If it's a reply, it updates the ARP table with the sender's MAC and IP address and sends any waiting packets for that IP.
   * The sending process uses the queue. It dequeues each packet from the original queue, checks if the packet was wainting for that ARP reply, it is sent, if it is not, is put in another queue. At the end of the process, the queue is updated with the new queue with the remaining packets.

## ICMP

    void generate_icmp_message(struct ether_header *eth_hdr, struct iphdr *ip_hdr, char buf[], int interface, int type, int code)

This function generates ICMP messages based on the type and code specified. It performs the following tasks:

   * Calculates the length of the ICMP message.
   * Populates the new IP header with appropriate values for ICMP.
   * Populates the ICMP header with the specified type and code.
   * Copies the original IP header and the first 8 bytes of the payload into the ICMP data field.
   * Computes the ICMP checksum.
   * Swaps Ethernet addresses, sets the source MAC address, and prepends the Ethernet header to the ICMP message.
   * Sends the ICMP message.

ICMP messages generated by this router include:

   * Echo Reply: Sent in response to an ICMP Echo Request when the packet is destined for the router itself or broadcast.
   * Time Exceeded: Sent when the TTL of an IP packet reaches zero.
   * Destination Unreachable: Sent when the router cannot forward a packet to its destination.

This ICMP functionality enhances network diagnostics and error reporting within the router's dataplane.

## Main Function

The main function initializes the router by:

   * Initializing the routing table, ARP table, and waiting packets queue.
   * Parsing the routing table and converting it to a trie.
   * Entering an infinite loop to receive and process packets.
